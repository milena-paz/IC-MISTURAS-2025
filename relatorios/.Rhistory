k<- length(mi)
X<- numeric(n)
tam <- as.vector(rmultinom(1,n,probs))
lims <- cumsum(c(0,tam))
for(i in 1:k){
X[lims[i]+1:lims[i+1]] <- rnorm(tam[i],mi[i],dp[i])
}
return(X)
}#Fim função geradora
n <- 200
mi <- c(160,173)
dp <- sqrt(c(15,12))
pesos <- c(.51,0.49)
X1 <- rMisturaNormAlt(n,mi,dp,pesos)
rMisturaNormAlt <- function(n,mi,dp,probs){
browser()
k<- length(mi)
X<- numeric(n)
tam <- as.vector(rmultinom(1,n,probs))
lims <- cumsum(c(0,tam))
for(i in 1:k){
X[lims[i]+1:lims[i+1]] <- rnorm(tam[i],mi[i],dp[i])
}
return(X)
}#Fim função geradora
n <- 10
mi <- c(160,173)
dp <- sqrt(c(15,12))
pesos <- c(.51,0.49)
X1 <- rMisturaNormAlt(n,mi,dp,pesos)
rMisturaNormAlt <- function(n,mi,dp,probs){
browser()
k<- length(mi)
X<- numeric(n)
tam <- as.vector(rmultinom(1,n,probs))
lims <- cumsum(c(0,tam))
for(i in 1:k){
X[lims[i]+1:lims[i+1]] <- rnorm(tam[i],mi[i],dp[i])
}
return(X)
}#Fim função geradora
n <- 10
mi <- c(160,173)
dp <- sqrt(c(15,12))
pesos <- c(.51,0.49)
X1 <- rMisturaNormAlt(n,mi,dp,pesos)
rMisturaNormAlt <- function(n,mi,dp,probs){
browser()
k<- length(mi)
X<- numeric(n)
tam <- as.vector(rmultinom(1,n,probs))
lims <- cumsum(c(0,tam))
for(i in 1:k){
X[lims[i]+1:lims[i+1]] <- rnorm(tam[i],mi[i],dp[i])
}
return(X)
}#Fim função geradora
n <- 5
mi <- c(160,173)
dp <- sqrt(c(15,12))
pesos <- c(.51,0.49)
X1 <- rMisturaNormAlt(n,mi,dp,pesos)
rMisturaNormAlt <- function(n,mi,dp,probs){
browser()
k<- length(mi)
X<- numeric(n)
tam <- as.vector(rmultinom(1,n,probs))
lims <- cumsum(c(0,tam))
for(i in 1:k){
X[(lims[i]+1):(lims[i+1])] <- rnorm(tam[i],mi[i],dp[i])
}
return(X)
}#Fim função geradora
rMisturaNormAlt <- function(n,mi,dp,probs){
browser()
k<- length(mi)
X<- numeric(n)
tam <- as.vector(rmultinom(1,n,probs))
lims <- cumsum(c(0,tam))
for(i in 1:k){
X[(lims[i]+1):lims[i+1]] <- rnorm(tam[i],mi[i],dp[i])
}
return(X)
}#Fim função geradora
n <- 5
mi <- c(160,173)
dp <- sqrt(c(15,12))
pesos <- c(.51,0.49)
X1 <- rMisturaNormAlt(n,mi,dp,pesos)
rMisturaNormAlt <- function(n,mi,dp,probs){
k<- length(mi)
X<- numeric(n)
tam <- as.vector(rmultinom(1,n,probs))
lims <- cumsum(c(0,tam))
for(i in 1:k){
X[(lims[i]+1):lims[i+1]] <- rnorm(tam[i],mi[i],dp[i])
}
return(X)
}#Fim função geradora
n <- 200
mi <- c(160,173)
dp <- sqrt(c(15,12))
pesos <- c(.51,0.49)
X1 <- rMisturaNormAlt(n,mi,dp,pesos)
#| code-fold: true
hist(X1, freq=F, breaks=20,col="orange",border="white",main="Histograma da amostra X1")
curve(dMisturaNorm(x,mi,dp,pesos),
add=T,col="darkblue",lty=2,lwd=2)
dMisturaNorm <- function(x,mi,dp,probs){
#---------------------------------------#
# x: vetor de valores a serem avaliados #
# mi: vetor de médias                   #
# dp: vetor de desvios padrão           #
# probs: vetor de pesos das componentes #
#---------------------------------------#
n <- length(mi)
if(length(x)==1)
#caso especial, quando x não é vetor
return(sum(probs*dnorm(x,mi,dp)))
return(rowSums(sapply(1:n,function(k) probs[k]*dnorm(x,mi[k],dp[k]))))
}
#| code-fold: true
hist(X1, freq=F, breaks=20,col="orange",border="white",main="Histograma da amostra X1")
curve(dMisturaNorm(x,mi,dp,pesos),
add=T,col="darkblue",lty=2,lwd=2)
n <- 200
mi <- c(160,173)
dp <- sqrt(c(15,12))
pesos <- c(.51,0.49)
X1 <- rMisturaNorm(n,mi,dp,pesos)
rMisturaNorm <- function(n,mi,dp,probs){
k<- length(mi)
X<- numeric(n)
U <- runif(n)
p <- cumsum(c(0,probs))
for(i in 1:k){
caso <- U <= p[i+1] & U> p[i]
tam <- sum(caso)
X[caso] <- rnorm(tam,mi[i],dp[i])
}
return(X)
}#Fim função geradora
n <- 200
mi <- c(160,173)
dp <- sqrt(c(15,12))
pesos <- c(.51,0.49)
X1 <- rMisturaNorm(n,mi,dp,pesos)
#| code-fold: true
hist(X1, freq=F, breaks=20,col="orange",border="white",main="Histograma da amostra X1")
curve(dMisturaNorm(x,mi,dp,pesos),
add=T,col="darkblue",lty=2,lwd=2)
n <- 200
mi <- c(160,173)
dp <- sqrt(c(15,12))
pesos <- c(.51,0.49)
X1 <- rMisturaNorm(n,mi,dp,pesos)
#| code-fold: true
hist(X1, freq=F, breaks=20,col="orange",border="white",main="Histograma da amostra X1")
curve(dMisturaNorm(x,mi,dp,pesos),
add=T,col="darkblue",lty=2,lwd=2)
mi <- 3*( (2/3)^(0:7) - 1)
dp <- sqrt((2/3)^(2*(0:7)))
pesos <- rep(1/8,8)
X2 <- rMisturaNormAlt(n, mi, dp, pesos)
#| fig-align: center
#| code-fold: true
hist(X2, freq=F, breaks=20,col="orange",border="white",main="Histograma da amostra X2")
curve(dMisturaNorm(x,mi,dp,pesos),
add=T,col="darkblue",lty=2,lwd=2)
#| fig-align: center
#| code-fold: true
amostras <- list(X1,X2,X3,X4)
#| code-fold: true
#| fig-align: center
curve(.51*dnorm(x,160,sqrt(15))+.49*dnorm(x,173,sqrt(12)),
main= "Mistura a",ylab="densidade",
from=150,to=190,lwd=2)
dMisturaNorm <- function(x,mi,dp,probs){
#---------------------------------------#
# x: vetor de valores a serem avaliados #
# mi: vetor de médias                   #
# dp: vetor de desvios padrão           #
# probs: vetor de pesos das componentes #
#---------------------------------------#
n <- length(mi)
if(length(x)==1)
#caso especial, quando x não é vetor
return(sum(probs*dnorm(x,mi,dp)))
return(rowSums(sapply(1:n,function(k) probs[k]*dnorm(x,mi[k],dp[k]))))
}
#| fig-align: center
#| code-fold: true
#implementação da mistura:
mi <- 3*( (2/3)^(0:7) - 1)
vars <- (2/3)^(2*(0:7))
pesos <- rep(1/8,8)
curve(dMisturaNorm(x,mi,sqrt(vars),pesos),
main= "Mistura b",ylab="densidade",
from=-3.5,to=1,lwd=2)
#| fig-align: center
# note que foi usado o valor de x-1, pois a parametrização do R difere da minha
x<- 1:50
plot(.5*dgeom(x-1,1/2)+.5*dgeom(x-1,1/3),
type="o",pch=".",cex=4,
main= "Mistura c",ylab="densidade",xlab="x",lwd=2)
#| fig-align: center
x<- 1:40
plot(.15*dpois(x,3)+.75*dpois(x,10)+.1*dpois(x,1.5),
type="o",pch=".",cex=4,
main= "Mistura d",ylab="densidade",xlab="x",lwd=2)
#| fig-align: center
curve(0.4*dunif(x)+0.6*dbeta(x,2,6),
main= "Mistura e",ylab="densidade",
lwd=2,ylim=c(0,2.1))
rMisturaNorm <- function(n,mi,dp,probs){
k<- length(mi)
X<- numeric(n)
U <- runif(n)
p <- cumsum(c(0,probs))
for(i in 1:k){
caso <- U <= p[i+1] & U> p[i]
tam <- sum(caso)
X[caso] <- rnorm(tam,mi[i],dp[i])
}
return(X)
}#Fim função geradora
n <- 200
mi <- c(160,173)
dp <- sqrt(c(15,12))
pesos <- c(.51,0.49)
X1 <- rMisturaNorm(n,mi,dp,pesos)
#| code-fold: true
#| fig-align: center
hist(X1, freq=F, breaks=20,col="orange",border="white",main="Histograma da amostra X1")
curve(dMisturaNorm(x,mi,dp,pesos),
add=T,col="darkblue",lty=2,lwd=2)
mi <- 3*( (2/3)^(0:7) - 1)
dp <- sqrt((2/3)^(2*(0:7)))
pesos <- rep(1/8,8)
X2 <- rMisturaNorm(n, mi, dp, pesos)
#| fig-align: center
#| code-fold: true
hist(X2, freq=F, breaks=20,col="orange",border="white",main="Histograma da amostra X2")
curve(dMisturaNorm(x,mi,dp,pesos),
add=T,col="darkblue",lty=2,lwd=2)
rMisturaNormAlt <- function(n,mi,dp,probs){
k<- length(mi)
X<- numeric(n)
tam <- as.vector(rmultinom(1,n,probs))
lims <- cumsum(c(0,tam))
for(i in 1:k){
X[(lims[i]+1):lims[i+1]] <- rnorm(tam[i],mi[i],dp[i])
}
return(X)
}#Fim função geradora
n <- 200
mi <- c(160,173)
dp <- sqrt(c(15,12))
pesos <- c(.51,0.49)
X3 <- rMisturaNormAlt(n,mi,dp,pesos)
#| fig-align: center
#| code-fold: true
hist(X3, freq=F, breaks=20,col="orange",border="white",main="Histograma da amostra X3")
curve(dMisturaNorm(x,mi,dp,pesos),
add=T,col="darkblue",lty=2,lwd=2)
mi <- 3*( (2/3)^(0:7) - 1)
dp <- sqrt((2/3)^(2*(0:7)))
pesos <- rep(1/8,8)
X4 <- rMisturaNormAlt(n, mi, dp, pesos)
#| fig-align: center
#| code-fold: true
hist(X4, freq=F, breaks=20,col="orange",border="white",main="Histograma da amostra X4")
curve(dMisturaNorm(x,mi,dp,pesos),
add=T,col="darkblue",lty=2,lwd=2)
#| fig-align: center
#| code-fold: true
amostras <- list(X1,X2,X3,X4)
for(i in 1:4){
hist(amostras[[i]], freq=F, breaks=20,col="orange",border="white",main=paste0("Histograma da amostra X",i))
}
#| fig-align: center
#| code-fold: true
par(mfrow=c(2,2))
amostras <- list(X1,X2,X3,X4)
for(i in 1:4){
hist(amostras[[i]], freq=F, breaks=20,col="orange",border="white",main=paste0("Histograma da amostra X",i))
}
#| fig-align: center
#| code-fold: true
par(mfrow=c(2,2),mar=c(3.1,2.1,2,1))
amostras <- list(X1,X2,X3,X4)
for(i in 1:4){
hist(amostras[[i]], freq=F, breaks=20,col="orange",border="white",main=paste0("Histograma da amostra X",i))
}
#| fig-align: center
#| code-fold: true
par(mfrow=c(2,2),mar=c(3.1,2.1,2,1))
amostras <- list(X1,X2,X3,X4)
for(i in 1:4){
hist(amostras[[i]], freq=F, breaks=20,
col="orange",border="white",main=paste0("Histograma da amostra X",i))
if(i%%2==0){
mi <- 3*( (2/3)^(0:7) - 1)
dp <- sqrt((2/3)^(2*(0:7)))
pesos <- rep(1/8,8)
}
else{
mi <- c(160,173)
dp <- sqrt(c(15,12))
pesos <- c(.51,0.49)
}
curve(dMisturaNorm(x,mi,dp,pesos),
add=T,col="darkblue",lty=2,lwd=2)
}
#fixando os parametros e tamanho amostral
n <- 100
nu <- 5
sigma2<- 4
mu <- 10
C <- rt(n, df=5)
y <- 10+C*sqrt(sigma2)
hist(y,freq=f)
hist(y,freq=F)
gamma(2)
dlst <- function(x){
gamma((nu+1)/2)/(gamma(nu/2)*sqrt(pi*nu*sigma2))*(1+(x-mu)^2/(sigma2*nu))^(-(nu+1)/2)
}
curve(dlst(x))
hist(y,freq=F)
curve(dlst(x),add=T,col="red")
hist(y,freq=F,breaks=20)
curve(dlst(x),add=T,col="red")
rm(dlst)
#fixando os parametros e tamanho amostral
n <- 30
nu <- 2
sigma2<- 6
mu <- 20
#gerando amostra t locacao-escala
y <- mu+rt(n, df=nu)*sqrt(sigma2)
l<- function(mu,sig){
-n/2*log(sig)-(nu+1)/2*sum(log(1+(y-mu)^2/(sig^2*nu)))
}#fim funcao logverossimilhanca de y
#funcao de checagem de criterio de parada
crit <- function(l1,mu,sig){
abs(l1-l(mu,sig)) > 1e-9
}
EM <- function(mu,sig ){
cont<-1
l1<-100
u <- 1
while(crit(l1,mu,sig)){
#--------PASSO E--------#
u <- (nu+1)/(nu+(y-mu)^2/sig)
#-----------------------#
l1<- l(mu,sig)
#--------PASSO M--------#
mu <- sum(u*y)/sum(u)
sig <- sum(u*(y-mu)^2)/n
#-----------------------#
cat("Iteração ",cont,": muhat=",mu," sig2hat=",sig,"\n")
cont<-cont+1
}
return(c(muhat=mu,sigma2hat=sig))
}#fim funcao algoritmo EM
# chute inicial usando media e variancia amostrais
EM(mean(y),var(y))
#fixando os parametros e tamanho amostral
n <- 30
nu <- 2
sigma2<- 6
mu <- 20
#gerando amostra t locacao-escala
y <- mu+rt(n, df=nu)*sqrt(sigma2)
l<- function(mu,sig){
-n/2*log(sig)-(nu+1)/2*sum(log(1+(y-mu)^2/(sig^2*nu)))
}#fim funcao logverossimilhanca de y
#funcao de checagem de criterio de parada
crit <- function(l1,mu,sig){
abs(l1-l(mu,sig)) > 1e-9
}
EM <- function(mu,sig ){
cont<-1
l1<-100
u <- 1
while(crit(l1,mu,sig)){
#--------PASSO E--------#
u <- (nu+1)/(nu+(y-mu)^2/sig)
#-----------------------#
l1<- l(mu,sig)
#--------PASSO M--------#
mu <- sum(u*y)/sum(u)
sig <- sum(u*(y-mu)^2)/n
#-----------------------#
cat("Iteração ",cont,": muhat=",mu," sig2hat=",sig,"\n")
cont<-cont+1
}
return(c(muhat=mu,sigma2hat=sig))
}#fim funcao algoritmo EM
# chute inicial usando media e variancia amostrais
EM(mean(y),var(y))
#fixando os parametros e tamanho amostral
n <- 30
nu <- 2
sigma2<- 6
mu <- 20
#gerando amostra t locacao-escala
y <- mu+rt(n, df=nu)*sqrt(sigma2)
l<- function(mu,sig){
-n/2*log(sig)-(nu+1)/2*sum(log(1+(y-mu)^2/(sig^2*nu)))
}#fim funcao logverossimilhanca de y
#funcao de checagem de criterio de parada
crit <- function(l1,mu,sig){
abs(l1-l(mu,sig)) > 1e-9
}
EM <- function(mu,sig ){
cont<-1
l1<-100
u <- 1
while(crit(l1,mu,sig)){
#--------PASSO E--------#
u <- (nu+1)/(nu+(y-mu)^2/sig)
#-----------------------#
l1<- l(mu,sig)
#--------PASSO M--------#
mu <- sum(u*y)/sum(u)
sig <- sum(u*(y-mu)^2)/n
#-----------------------#
cat("Iteração ",cont,": muhat=",mu," sig2hat=",sig,"\n")
cont<-cont+1
}
return(c(muhat=mu,sigma2hat=sig))
}#fim funcao algoritmo EM
# chute inicial usando media e variancia amostrais
EM(mean(y),var(y))
#usando a mesma amostra do exemplo anterior(!)
l<- function(nu,mu,sig){
n*(lgamma((nu+1)/2)-lgamma(nu/2) -log(sig*pi*nu)/2)-
(nu+1)/2*sum(log(1+(y-mu)^2/(sig^2*nu)))
}#fim funcao logverossimilhanca
#funcao de checagem de criterio de parada
crit <- function(ll,nu,mu,sig){
ll2 <- l(nu,mu,sig)
abs(ll2-ll)/(abs(ll) + 1e-8) > 1e-6
}
CM2 <- function(nu, u, logu){
log(nu/2) - digamma(nu/2) + 1 + mean(logu - u)
}
ECM <- function(nu,mu,sig,MaxIter=50){
cont<-1
l1<-100
u <- 1
logu <- 1
while(crit(l1,nu,mu,sig)&cont<=MaxIter){
#--------PASSO E--------#
d2 <- (y-mu)^2/sig
u <- (nu+1)/(nu+d2)
logu <- digamma((nu+1)/2) - log((nu+d2)/2)
#-----------------------#
l1<- l(nu,mu,sig)
#------PASSO CM-1-------#
mu <- sum(u*y)/sum(u)
sig <- sum(u*(y-mu)^2)/n
#-----------------------#
#------PASSO CM-2-------#
if(CM2(1e-3,u,logu) * CM2(100,u,logu) < 0) #criterio para que uniroot() funcione
nu <- uniroot(CM2, c(1e-3,100), u=u, logu=logu)$root
#-----------------------#
cat("Iteração ",cont,": nuhat=",nu," muhat=",mu," sigma2hat=",sig,"\n")
cont<-cont+1
}
return(c(nuhat=nu,muhat=mu,sigma2hat=sig))
}#fim funcao algoritmo ECM
# chute inicial usando media e variancia amostrais
ECM(1,mean(y),var(y))
#reusando mesma amostra do exemplo 2.1 e funções de critério de parada e verossimilhança de 3.1.1
CML2 <- function(nu,mu,sig){
d2 <- (y-mu)^2/sig
return(
n*(digamma((nu+1)/2)-digamma(nu/2)-1/(nu*2))-
sum(log(1+d2/nu))+
(nu+1)/(nu^2)*sum(d2/(nu+d2))
)
}
ECME <- function(nu,mu,sig){
cont<-1
l1<-100
u <- 1
logu <- 1
while(crit(l1,nu,mu,sig)){
d2 <- (y-mu)^2/sig
#---------PASSO E--------#
u <- (nu+1)/(nu+d2)
logu <- digamma((nu+1)/2) - log((nu+d2)/2)
#------------------------#
l1<- l(nu,mu,sig)
#-------PASSO CM-1-------#
mu <- sum(u*y)/sum(u)
sig <- sum(u*(y-mu)^2)/n
#------PASSO CML-2-------#
if(CML2(0.001,mu,sig)*CML2(100,mu,sig)<0)
nu <- uniroot(CML2,
interval=c(0.01,100),
mu=mu,sig=sig)$root
#------------------------#
cat("Iteração ",cont,": nuhat=",nu," muhat=",mu," sigma2hat=",sig,"\n")
cont<-cont+1
}
return(c(nuhat=nu,muhat=mu,sigmahat=sig))
}#fim funcao algoritmo ECME
# chute inicial usando media e variancia amostrais
ECME(1,mean(y),var(y))
